<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8" />
<title>首页</title>
<link rel="icon" th:href="@{/custom/common/image/logo.ico}"
	type="image/x-icon" />

<!-- css -->
<link rel="stylesheet"
	href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.css">
<link rel="stylesheet" type="text/css" media="all"
	th:href="@{/plugin/layui/css/layui.css}" />
<link rel="stylesheet" type="text/css" media="all"
	th:href="@{/custom/common/css/common.css}" />
<link rel="stylesheet" type="text/css" media="all"
	th:href="@{/custom/index/index.css}" />
<script th:src="@{/plugin/jquery/jquery.min.js}"></script>
<script th:src="@{/plugin/layui/layui.js}"></script>
<script th:src="@{/custom/common/js/common.js}"></script>
<script th:src="@{/custom/common/js/ajaxCustome.js}"></script>
<script th:src="@{/custom/common/js/time.js}"></script>
<script th:src="@{/custom/common/js/number.js}"></script>

<script type="text/javascript">
layui.use(['layer','util'], function() {
	var util = layui.util;
	var layer = layui.layer;
	
	$(function() {
		loadList(1, 3, "new-tip");
		loadList(1, 5, "hot-tip");
		loadList(1, 5, "audit-tip");
		//绑定技巧跳转链接
		// 		$('a[class="tip-info"]').click(function() {
		// 			var tipId = $(this).attr("data");
		// 			location.href = "/tip/" + tipId + "/detail";
		// 		});
	
		iniSignButton();
		iniWebStatus();
		
		$('button[data-type="sign"]').on("click",function(){
			$.post("/api/member/a/sign",function(rd){
				if(rd.result){
					layer.msg("签到成功，获得 10 积分");
					iniSignButton();
				}
			});
		});
		
		
	});
	function loadList(pageNum, pageSize, boxId) {
		var tipShowBox = $("#" + boxId);
		tipShowBox.empty();
		var getUrl = "/api/tip/release/list";
		$.get(getUrl,{"pageNum":pageNum,"pageSize":pageSize},function(result) {
				$.each(result.data.list,function(n, value) {
					var memberId = value.belongMember.id;
					tipShowBox
							.append('<div class="tip-entry">'
									+ '<div class="tip-record">'
									+ '<div class="member" data="'+memberId+'">'
									+ '<img src="'+value.belongMember.headUrl+'" />'
									+ '<a class="member-info"'+ 'href="/member/'+ memberId+'/space">'+ value.belongMember.nickname+ '</a>'
									+ '<span class="motto">'+value.belongMember.motto+'</span>'
									+ '</div>'
									+ '<div class="tip-info">'
									+'<a class="tip-title"'
									+ 'href="/tip/'+value.id+'/detail">'
									+ value.title
									+ '</a>'
									+ '<div class="tip-bottom">'
									+ '<span class="time">'
									+ getDateDiff(value.gmtCreate)
									+ '</span>'
									+ '<span>'
									+'&nbsp;<i class="layui-icon">&#xe65f;</i>'  
									+ '</span>'
									+ '<span>'+value.commentCount+'<i class="fa fa-commenting-o"></i></span>'
									+ '<span>'
									+'23<i class="fa fa-thumbs-o-up"></i>'  
									+ '</span>'
									+ '<span>'
									+'0<i class="fa fa-thumbs-o-down"></i>'  
									+ '</span>'
									+'</div></div></div></div>');
				});
			});
	}
	
	//ini sign button 
	function iniSignButton(){
		var signButton = $('button[data-type="sign"]');
		var unAbleClass = "layui-btn-disabled";
		var ableClass = "layui-btn-danger";
		if(entryStatus()){
			$.get("/api/member/a/sign",function(rd){
				if(rd.result){
					signButton.addClass(unAbleClass);
					signButton.removeClass(ableClass);
					signButton.text("已签到");
					signButton.attr("data-type","");
					signButton.unbind();
				}else{
					signButton.addClass(ableClass);
					signButton.removeClass(unAbleClass);
				}
			});
		}else{
			signButton.parent().remove();
		}
	}
	
	function iniWebStatus(){
		$.get("/api/m/index",function(rd){
			if(rd.result){
				autoIncrease(rd.data.actMemberNum, $("#actMemberNum"));
			}
		});
	}


	//bottom right
	util.fixbar({
	   bar1: "&#xe609;",
	   click: function(type){
	      console.log(type);
	      if(type === 'bar1'){
	       location.href="/tip/a/write";
	      }
	    }
	});
});
</script>



</head>
<body>
	<div class="tip-page">
		<!-- index-nav -->
		<div th:include="/_model/_index-nav :: index-nav"></div>
		<div class="layui-container main-box">
			<!-- main -->
			<div class="layui-row">
				<div class="layui-col-md12 search">
					<div class="layui-col-md8 layui-col-md-offset-2">
						<form class="layui-form">
							<div class="layui-form-item">
								<div class="layui-inline">
									<div class="layui-input-inline" style="width: 400px">
										<input type="text" class="layui-input" lay-verify="required"
											autocomplete="off" id="name" placeholder="请输入技巧名称">
									</div>
								</div>
								<div class="layui-inline">
									<button type="submit" class="layui-btn">搜索</button>
								</div>
							</div>
						</form>
					</div>
				</div>
				<div class="layui-row layui-col-space20">
					<div class="layui-col-md9 left-box">
						<div class="layui-row">
							<div class="layui-col-md12">
								<div class="list-title">最新技巧</div>
								<div id="new-tip" class="tip-list"></div>
							</div>
						</div>

						<div class="layui-row">
							<div class="layui-col-md12">
								<div class="list-title">最热技巧</div>
								<div id="hot-tip" class="tip-list"></div>
							</div>
						</div>
						<div class="layui-row">
							<div class="layui-col-md12">
								<div class="list-title">待评技巧</div>
								<div id="audit-tip" class="tip-list"></div>
							</div>
						</div>
					</div>

					<div class="layui-col-md3 right-box">
						<div class="layui-row">
							<div class="layui-col-md12 sign">
								<button data-type="sign" class="layui-btn layui-btn-danger">签到</button>
							</div>
							<div class="layui-col-md12">
								<div class="status">
									<p>活跃用户：<span id="actMemberNum">0</span></p>
								</div>
							</div>
						</div>
						
						<div class="layui-row">
							<div class="layui-col-md12 sign">
								技巧展示位
							</div>
						</div>
						<div class="layui-row">
							<div class="layui-col-md12 sign">
								广告位
							</div>
						</div>
						<div class="layui-row">
							<div class="layui-col-md12 sign">
								用户展示位
							</div>
						</div>
						<div class="layui-row">
							<div class="layui-col-md12 sign">
								友情链接
								
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- footer -->
		<div th:include="/_model/_footer :: tip-footer"></div>
	</div>
</body>
</html>