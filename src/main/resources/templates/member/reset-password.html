<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8" />
<title>密码找回</title>
<link rel="icon" th:href="@{/custom/common/image/logo.ico}"
	type="image/x-icon" />

<link rel="stylesheet" type="text/css" media="all"
	th:href="@{/plugin/layui/css/layui.css}" />
<link rel="stylesheet" type="text/css"
	th:href="@{/custom/common/css/common.css}" />
<script th:src="@{/plugin/jquery/jquery.min.js}"></script>
<script th:src="@{/plugin/layui/layui.js}"></script>
<script th:src="@{/custom/common/js/common.js}"></script>
<script th:src="@{/plugin/validate/jquery.validate.min.js}"></script>
<script th:src="@{/custom/common/js/ajaxCustome.js}"></script>
<style type="text/css">

.signup-box-form {
	padding: 60px 70px 0px 0px;
	background: #fefefe;
}

.signup-box-form .layui-form-item {
	margin-bottom: 30px;
}

.layui-form-item {
	position: relative;
}

.sendsms-link {
	top: 9px; position : absolute; left : 280px;
	color: #00AEF3 !important;
	position: absolute;
	left: 280px;
}

.count-down {
	top: 9px; position : absolute;
	left: 280px;
	color: #c2c2c2 !important;
	display: none;
	position: absolute;
}

.signup-submit {
	width: 100%;
	margin-top: 10px;
}

.signin-link {
	text-align: center;
	margin-top: 30px;
}
</style>
<script>
	layui.use([ 'form', 'util','layer' ], function() {
		var form = layui.form;
		var util = layui.util;
		var layer = layui.layer;
		$(function() {
			$("button[data='submit']").click(function() {
				var newPassword =$("input[name='newPassword']").val();
				var confirmPassword= $("input[name='password']").val();
				if(newPassword != confirmPassword){
					layer.msg('两次密码填写不一致'); 
					return;
				}
				var dataJson = {};
				dataJson.phoneNumber=$("input[name='phoneNumber']").val();
				dataJson.vcode=$("input[name='vcode']").val();
				dataJson.password=newPassword;
				$.ajax({
					url:"/api/member/reset/pw",
					type:"PATCH",
					data: JSON.stringify(dataJson),
					contentType:CTJ,
					success:function(rd){
						if(rd.result){
							layer.msg('重置成功'); 
							setTimeout(function(){
								location.href = "/login/signin";
							},1000);
						}else{
							layer.msg('找回失败 , 请稍后再试'); 
						}
					}
				});
			});

			$(".sendsms-link").click(
					function() {
						var phoneNumber = $('input[name="phoneNumber"]').val();
						$.get('/api/sms/register', {
							"phoneNumber" : phoneNumber
						}, function(rd) {
							if (rd.result) {
								var serverTime = new Date(rd.data.sendDate);
								var endTime = new Date(
										serverTime.getTime() + 1000 * 60);
								util.countdown(endTime, serverTime, function(
										date, serverTime, timer) {
									var currentSecond = date[3];
									if (currentSecond == 0) {
										$('.count-down').hide();
										$('.sendsms-link').show();
										return;
									}
									var countdownTip = date[3] + ' 秒后可重发';
									$('.sendsms-link').hide();
									$('.count-down').html(countdownTip);
									$('.count-down').show();
								});
							} else {
								alert("发送失败");
							}
						});
					});
		});
	});
</script>

</head>
<body>
	<div class="tip-page">
		<!-- index-nav -->
		<div th:include="/_model/_index-nav :: index-nav"></div>

		<div class="layui-container">
			<div class="layui-row">
				<div class="signup-box-form layui-col-md6 layui-col-md-offset3">
					<form class="layui-form" method="POST" novalidate="novalidate">
						<div class="layui-form-item">
							<label for="phoneNumber" class="layui-form-label">手机号</label>

							<div class="layui-input-block">
								<input name="phoneNumber" type="text" lay-verify="required"
									class="layui-input" placeholder="请输入手机号" value=""
									id="phoneNumber"> <a class="sendsms-link"
									href="javascript:;">获取短信验证码</a> <span class="count-down">倒计时</span>
							</div>
						</div>
						<div class="layui-form-item">
							<label for="vcode" class="layui-form-label">验证码</label>
							<div class="layui-input-block">
								<input name="vcode" type="text" lay-verify="required"
									class="layui-input" autocomplete="off"  id="vcode" value="" placeholder="请输入验证码">
							</div>
						</div>
						<div class="layui-form-item">
							<label for="newPassword" class="layui-form-label">新密码</label>
							<div class="layui-input-block">
								<input type="password" lay-verify="required" name="newPassword"
									class="layui-input" autocomplete="off" id="newPassword" value="" placeholder="请输入新密码">
							</div>
						</div>
						<div class="layui-form-item">
							<label for="password" class="layui-form-label">确认密码</label>
							<div class="layui-input-block">
								<input name="password" type="password" lay-verify="required"
									class="layui-input" autocomplete="off" id="password" value="" placeholder="请重新输入新密码">
							</div>
						</div>

						<div class="layui-form-item">
							<div class="layui-input-block">
								<button data="submit" type="button"
									class="signup-submit layui-btn">注册</button>
							</div>
							<div class="signin-link layui-input-block">
								<a th:href="@{/login/signin}">我有账号，直接登录</a>
							</div>
						</div>
					</form>
				</div>
			</div>
		</div>
		
		<!-- footer -->
		<div th:include="/_model/_footer :: tip-footer"></div>
	</div>
</body>
</html>